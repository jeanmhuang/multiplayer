<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Climate Champions - Climate Action Game</title>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            overflow: hidden;
            background: #1a1a1a;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        #gameCanvas {
            display: block;
        }
        
        #startScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #7e8ba3 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
        }
        
        #startScreen h1 {
            font-size: 64px;
            margin-bottom: 20px;
            color: #4ade80;
            text-shadow: 0 0 30px rgba(74, 222, 128, 0.5);
            letter-spacing: 2px;
        }
        
        .subtitle {
            font-size: 24px;
            color: #93c5fd;
            margin-bottom: 30px;
            font-weight: 300;
        }
        
        .mission {
            background: rgba(0, 0, 0, 0.3);
            padding: 25px;
            border-radius: 15px;
            max-width: 600px;
            margin-bottom: 30px;
            border: 2px solid rgba(74, 222, 128, 0.3);
        }
        
        .mission h3 {
            color: #4ade80;
            margin-bottom: 15px;
            font-size: 20px;
        }
        
        .mission ul {
            list-style: none;
            padding: 0;
        }
        
        .mission li {
            padding: 8px 0;
            padding-left: 30px;
            position: relative;
            font-size: 16px;
            line-height: 1.5;
        }
        
        .mission li:before {
            content: "üåç";
            position: absolute;
            left: 0;
        }
        
        #nameInput {
            padding: 15px 25px;
            font-size: 18px;
            border: 3px solid #4ade80;
            background: rgba(255, 255, 255, 0.9);
            color: #1a1a1a;
            border-radius: 10px;
            margin-bottom: 20px;
            width: 350px;
            text-align: center;
            font-weight: 600;
        }
        
        #nameInput:focus {
            outline: none;
            box-shadow: 0 0 30px rgba(74, 222, 128, 0.6);
        }
        
        #startButton {
            padding: 18px 60px;
            font-size: 26px;
            background: linear-gradient(135deg, #4ade80, #22c55e);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 5px 20px rgba(74, 222, 128, 0.4);
        }
        
        #startButton:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(74, 222, 128, 0.6);
        }
        
        .controls {
            margin-top: 25px;
            color: #cbd5e1;
            font-size: 15px;
            text-align: center;
        }
        
        .controls div {
            margin: 6px 0;
        }
        
        #hud {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            font-size: 16px;
            background: rgba(0, 0, 0, 0.75);
            padding: 20px;
            border-radius: 12px;
            border: 3px solid #4ade80;
            min-width: 220px;
            backdrop-filter: blur(10px);
        }
        
        #hud h3 {
            color: #4ade80;
            margin-bottom: 12px;
            font-size: 18px;
            border-bottom: 2px solid #4ade80;
            padding-bottom: 8px;
        }
        
        #hud .stat {
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 15px;
        }
        
        #hud .stat-label {
            color: #93c5fd;
        }
        
        #hud .stat-value {
            font-weight: bold;
            color: #4ade80;
            font-size: 17px;
        }
        
        #impactMeter {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 400px;
            background: rgba(0, 0, 0, 0.75);
            padding: 15px 20px;
            border-radius: 12px;
            border: 3px solid #4ade80;
            backdrop-filter: blur(10px);
        }
        
        #impactMeter h4 {
            color: #4ade80;
            margin-bottom: 10px;
            font-size: 16px;
            text-align: center;
        }
        
        .meter-bar {
            width: 100%;
            height: 25px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            border: 2px solid #333;
        }
        
        .meter-fill {
            height: 100%;
            background: linear-gradient(90deg, #ef4444, #f59e0b, #4ade80);
            transition: width 0.5s;
            border-radius: 10px;
        }
        
        .meter-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            font-size: 13px;
            text-shadow: 1px 1px 3px black;
        }
        
        #leaderboard {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.75);
            padding: 20px;
            border-radius: 12px;
            border: 3px solid #4ade80;
            color: white;
            min-width: 240px;
            backdrop-filter: blur(10px);
        }
        
        #leaderboard h3 {
            margin-bottom: 12px;
            text-align: center;
            color: #4ade80;
            border-bottom: 2px solid #4ade80;
            padding-bottom: 8px;
            font-size: 18px;
        }
        
        .leaderboard-entry {
            padding: 8px;
            margin: 6px 0;
            font-size: 14px;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
        }
        
        .leaderboard-entry.player {
            background: rgba(74, 222, 128, 0.25);
            font-weight: bold;
            border: 2px solid #4ade80;
        }
        
        .rank {
            color: #fbbf24;
            font-weight: bold;
            margin-right: 8px;
        }
        
        #actions {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.75);
            padding: 15px 25px;
            border-radius: 12px;
            border: 3px solid #4ade80;
            color: white;
            backdrop-filter: blur(10px);
            display: flex;
            gap: 15px;
        }
        
        .action-button {
            padding: 12px 20px;
            font-size: 14px;
            font-weight: bold;
            border: 2px solid;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            min-width: 120px;
        }
        
        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .action-button.tree {
            background: rgba(34, 197, 94, 0.2);
            border-color: #22c55e;
            color: #22c55e;
        }
        
        .action-button.cleanup {
            background: rgba(59, 130, 246, 0.2);
            border-color: #3b82f6;
            color: #3b82f6;
        }
        
        .action-button.solar {
            background: rgba(251, 191, 36, 0.2);
            border-color: #fbbf24;
            color: #fbbf24;
        }
        
        .action-icon {
            font-size: 24px;
        }
        
        .action-label {
            font-size: 12px;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    
    <div id="startScreen">
        <h1>üåç CLIMATE CHAMPIONS üåç</h1>
        <div class="subtitle">Restore the Planet ‚Ä¢ Combat Climate Change</div>
        
        <div class="mission">
            <h3>YOUR MISSION:</h3>
            <ul>
                <li>Plant trees to absorb CO‚ÇÇ and restore forests</li>
                <li>Clean up pollution from land and water</li>
                <li>Deploy solar panels for renewable energy</li>
                <li>Protect ecosystems from environmental threats</li>
                <li>Compete with other guardians to heal the Earth!</li>
            </ul>
        </div>
        
        <input type="text" id="nameInput" placeholder="Enter Champion Name" maxlength="12">
        <button id="startButton">START MISSION</button>
        
        <div class="controls">
            <div>üéÆ <strong>WASD / Arrow Keys</strong> - Move</div>
            <div>üå≥ <strong>1 or T</strong> - Plant Tree</div>
            <div>üßπ <strong>2 or C</strong> - Clean Pollution</div>
            <div>‚òÄÔ∏è <strong>3 or S</strong> - Deploy Solar Panel</div>
        </div>
    </div>
    
    <div id="hud" style="display: none;">
        <h3>üåø YOUR STATS</h3>
        <div class="stat">
            <span class="stat-label">üå≥ Trees:</span>
            <span class="stat-value" id="trees">0</span>
        </div>
        <div class="stat">
            <span class="stat-label">üßπ Cleaned:</span>
            <span class="stat-value" id="cleaned">0</span>
        </div>
        <div class="stat">
            <span class="stat-label">‚òÄÔ∏è Solar:</span>
            <span class="stat-value" id="solar">0</span>
        </div>
        <div class="stat">
            <span class="stat-label">‚≠ê Impact:</span>
            <span class="stat-value" id="impact">0</span>
        </div>
    </div>
    
    <div id="impactMeter" style="display: none;">
        <h4>üåç GLOBAL ECOSYSTEM HEALTH</h4>
        <div class="meter-bar">
            <div class="meter-fill" id="healthFill" style="width: 30%;"></div>
            <div class="meter-text" id="healthText">30%</div>
        </div>
    </div>
    
    <div id="leaderboard" style="display: none;">
        <h3>üèÜ TOP GUARDIANS</h3>
        <div id="leaderboardContent"></div>
    </div>
    
    <div id="actions" style="display: none;">
        <div class="action-button tree" onclick="setAction('tree')">
            <span class="action-icon">üå≥</span>
            <span class="action-label">PLANT (1)</span>
        </div>
        <div class="action-button cleanup" onclick="setAction('cleanup')">
            <span class="action-icon">üßπ</span>
            <span class="action-label">CLEAN (2)</span>
        </div>
        <div class="action-button solar" onclick="setAction('solar')">
            <span class="action-icon">‚òÄÔ∏è</span>
            <span class="action-label">SOLAR (3)</span>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });
        
        // Game constants
        const WORLD_SIZE = 3500;
        const TILE_SIZE = 50;
        const PLAYER_SIZE = 20;
        const BOT_COUNT = 6;
        const POLLUTION_COUNT = 100;
        const INITIAL_HEALTH = 30;
        
        // Game state
        let gameStarted = false;
        let keys = {};
        let camera = { x: 0, y: 0 };
        let currentAction = 'tree';
        let ecosystemHealth = INITIAL_HEALTH;
        let healthIncrease = 0;
        
        // Game objects
        let player = null;
        let bots = [];
        let tiles = [];
        let pollution = [];
        let trees = [];
        let solarPanels = [];
        let particles = [];
        
        // Colors
        const TILE_COLORS = {
            dirt: '#8b7355',
            grass: '#7cb342',
            forest: '#2e7d32',
            water: '#1976d2',
            polluted_water: '#424242',
            polluted_land: '#4a4a4a'
        };
        
        // Champion class
        class Champion {
            constructor(x, y, name, color, isPlayer = false) {
                this.x = x;
                this.y = y;
                this.vx = 0;
                this.vy = 0;
                this.name = name;
                this.color = color;
                this.isPlayer = isPlayer;
                this.size = PLAYER_SIZE;
                this.treesPlanted = 0;
                this.pollutionCleaned = 0;
                this.solarDeployed = 0;
                this.impact = 0;
                this.actionCooldown = 0;
            }
            
            update() {
                if (this.isPlayer) {
                    const speed = 4;
                    if (keys['w'] || keys['W'] || keys['ArrowUp']) this.vy = -speed;
                    else if (keys['s'] || keys['S'] || keys['ArrowDown']) this.vy = speed;
                    else this.vy *= 0.85;
                    
                    if (keys['a'] || keys['A'] || keys['ArrowLeft']) this.vx = -speed;
                    else if (keys['d'] || keys['D'] || keys['ArrowRight']) this.vx = speed;
                    else this.vx *= 0.85;
                } else {
                    // Bot AI
                    if (Math.random() < 0.02) {
                        // Find nearest pollution or good spot
                        let target = null;
                        let minDist = Infinity;
                        
                        for (let p of pollution) {
                            const dist = Math.hypot(p.x - this.x, p.y - this.y);
                            if (dist < minDist) {
                                minDist = dist;
                                target = p;
                            }
                        }
                        
                        if (target) {
                            this.targetX = target.x;
                            this.targetY = target.y;
                            this.nextAction = 'cleanup';
                        } else if (Math.random() < 0.5) {
                            this.targetX = Math.random() * WORLD_SIZE;
                            this.targetY = Math.random() * WORLD_SIZE;
                            this.nextAction = Math.random() < 0.7 ? 'tree' : 'solar';
                        }
                    }
                    
                    if (this.targetX !== undefined) {
                        const dx = this.targetX - this.x;
                        const dy = this.targetY - this.y;
                        const dist = Math.hypot(dx, dy);
                        
                        if (dist > 5) {
                            this.vx = (dx / dist) * 3.5;
                            this.vy = (dy / dist) * 3.5;
                        } else if (this.actionCooldown === 0 && this.nextAction) {
                            this.performAction(this.nextAction);
                            this.targetX = undefined;
                        }
                    }
                }
                
                this.x += this.vx;
                this.y += this.vy;
                
                // Keep in bounds
                this.x = Math.max(this.size, Math.min(WORLD_SIZE - this.size, this.x));
                this.y = Math.max(this.size, Math.min(WORLD_SIZE - this.size, this.y));
                
                if (this.actionCooldown > 0) this.actionCooldown--;
            }
            
            performAction(action) {
                if (this.actionCooldown > 0) return false;
                
                const gridX = Math.floor(this.x / TILE_SIZE);
                const gridY = Math.floor(this.y / TILE_SIZE);
                
                if (action === 'tree') {
                    // Check if tile can have tree
                    const tile = getTile(gridX, gridY);
                    if (tile && (tile.type === 'grass' || tile.type === 'dirt') && 
                        !hasTree(gridX, gridY) && !hasSolar(gridX, gridY)) {
                        trees.push({ x: gridX * TILE_SIZE + TILE_SIZE/2, y: gridY * TILE_SIZE + TILE_SIZE/2, age: 0, gridX, gridY });
                        this.treesPlanted++;
                        this.impact += 10;
                        this.actionCooldown = 30;
                        createParticles(this.x, this.y, '#22c55e', 5);
                        healthIncrease += 0.5;
                        return true;
                    }
                } else if (action === 'cleanup') {
                    // Check for nearby pollution
                    for (let i = pollution.length - 1; i >= 0; i--) {
                        const p = pollution[i];
                        if (Math.hypot(p.x - this.x, p.y - this.y) < 40) {
                            const tile = getTile(Math.floor(p.x / TILE_SIZE), Math.floor(p.y / TILE_SIZE));
                            if (tile) {
                                if (tile.type === 'polluted_water') tile.type = 'water';
                                else if (tile.type === 'polluted_land') tile.type = 'grass';
                            }
                            pollution.splice(i, 1);
                            this.pollutionCleaned++;
                            this.impact += 15;
                            this.actionCooldown = 20;
                            createParticles(p.x, p.y, '#3b82f6', 8);
                            healthIncrease += 0.8;
                            return true;
                        }
                    }
                } else if (action === 'solar') {
                    const tile = getTile(gridX, gridY);
                    if (tile && tile.type !== 'water' && tile.type !== 'polluted_water' && 
                        !hasTree(gridX, gridY) && !hasSolar(gridX, gridY)) {
                        solarPanels.push({ x: gridX * TILE_SIZE + TILE_SIZE/2, y: gridY * TILE_SIZE + TILE_SIZE/2, gridX, gridY });
                        this.solarDeployed++;
                        this.impact += 8;
                        this.actionCooldown = 25;
                        createParticles(this.x, this.y, '#fbbf24', 5);
                        healthIncrease += 0.4;
                        return true;
                    }
                }
                return false;
            }
            
            draw() {
                ctx.save();
                ctx.translate(this.x - camera.x, this.y - camera.y);
                
                // Draw guardian body
                ctx.beginPath();
                ctx.arc(0, 0, this.size, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 3;
                ctx.stroke();
                
                // Draw current action icon
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                if (this.isPlayer) {
                    const icon = currentAction === 'tree' ? 'üå≥' : currentAction === 'cleanup' ? 'üßπ' : '‚òÄÔ∏è';
                    ctx.fillText(icon, 0, 0);
                } else {
                    ctx.fillText('ü§ñ', 0, 0);
                }
                
                ctx.restore();
                
                // Draw name
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 13px Arial';
                ctx.textAlign = 'center';
                ctx.strokeStyle = '#000';
                ctx.lineWidth = 3;
                ctx.strokeText(this.name, this.x - camera.x, this.y - camera.y - this.size - 10);
                ctx.fillText(this.name, this.x - camera.x, this.y - camera.y - this.size - 10);
            }
        }
        
        // Tile system
        function initTiles() {
            const cols = Math.ceil(WORLD_SIZE / TILE_SIZE);
            const rows = Math.ceil(WORLD_SIZE / TILE_SIZE);
            
            for (let y = 0; y < rows; y++) {
                for (let x = 0; x < cols; x++) {
                    let type = 'grass';
                    const rand = Math.random();
                    
                    if (rand < 0.15) type = 'water';
                    else if (rand < 0.25) type = 'dirt';
                    else if (rand < 0.35) type = 'forest';
                    
                    tiles.push({ x, y, type });
                }
            }
        }
        
        function getTile(x, y) {
            const cols = Math.ceil(WORLD_SIZE / TILE_SIZE);
            return tiles[y * cols + x];
        }
        
        function hasTree(gridX, gridY) {
            return trees.some(t => t.gridX === gridX && t.gridY === gridY);
        }
        
        function hasSolar(gridX, gridY) {
            return solarPanels.some(s => s.gridX === gridX && s.gridY === gridY);
        }
        
        // Particle system
        function createParticles(x, y, color, count) {
            for (let i = 0; i < count; i++) {
                particles.push({
                    x, y,
                    vx: (Math.random() - 0.5) * 4,
                    vy: (Math.random() - 0.5) * 4,
                    color,
                    life: 30
                });
            }
        }
        
        // Initialize game
        function init() {
            const playerName = document.getElementById('nameInput').value.trim() || 'Champion';
            player = new Champion(WORLD_SIZE / 2, WORLD_SIZE / 2, playerName, '#4ade80', true);
            
            // Initialize world
            initTiles();
            
            // Create pollution
            pollution = [];
            for (let i = 0; i < POLLUTION_COUNT; i++) {
                const x = Math.random() * WORLD_SIZE;
                const y = Math.random() * WORLD_SIZE;
                const gridX = Math.floor(x / TILE_SIZE);
                const gridY = Math.floor(y / TILE_SIZE);
                const tile = getTile(gridX, gridY);
                
                if (tile) {
                    if (tile.type === 'water') tile.type = 'polluted_water';
                    else if (tile.type === 'grass' || tile.type === 'dirt') tile.type = 'polluted_land';
                    pollution.push({ x, y });
                }
            }
            
            // Create some initial trees
            for (let i = 0; i < 30; i++) {
                const gridX = Math.floor(Math.random() * (WORLD_SIZE / TILE_SIZE));
                const gridY = Math.floor(Math.random() * (WORLD_SIZE / TILE_SIZE));
                const tile = getTile(gridX, gridY);
                if (tile && tile.type === 'forest') {
                    trees.push({ x: gridX * TILE_SIZE + TILE_SIZE/2, y: gridY * TILE_SIZE + TILE_SIZE/2, age: 100, gridX, gridY });
                }
            }
            
            // Create bots
            bots = [];
            const botNames = ['Flora', 'Terra', 'Gaia', 'Eco', 'Verde', 'Luna'];
            const botColors = ['#10b981', '#059669', '#84cc16', '#65a30d', '#22d3ee', '#06b6d4'];
            for (let i = 0; i < BOT_COUNT; i++) {
                bots.push(new Champion(
                    Math.random() * WORLD_SIZE,
                    Math.random() * WORLD_SIZE,
                    botNames[i],
                    botColors[i],
                    false
                ));
            }
            
            gameStarted = true;
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('hud').style.display = 'block';
            document.getElementById('impactMeter').style.display = 'block';
            document.getElementById('leaderboard').style.display = 'block';
            document.getElementById('actions').style.display = 'flex';
            
            gameLoop();
        }
        
        // Set action
        function setAction(action) {
            currentAction = action;
            document.querySelectorAll('.action-button').forEach(btn => {
                btn.style.opacity = '0.6';
            });
            if (action === 'tree') document.querySelector('.action-button.tree').style.opacity = '1';
            else if (action === 'cleanup') document.querySelector('.action-button.cleanup').style.opacity = '1';
            else if (action === 'solar') document.querySelector('.action-button.solar').style.opacity = '1';
        }
        
        // Update game
        function update() {
            if (!player) return;
            
            player.update();
            
            // Update camera
            camera.x = player.x - canvas.width / 2;
            camera.y = player.y - canvas.height / 2;
            camera.x = Math.max(0, Math.min(WORLD_SIZE - canvas.width, camera.x));
            camera.y = Math.max(0, Math.min(WORLD_SIZE - canvas.height, camera.y));
            
            // Update bots
            for (let bot of bots) {
                bot.update();
            }
            
            // Grow trees
            for (let tree of trees) {
                if (tree.age < 100) tree.age++;
            }
            
            // Update particles
            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.x += p.vx;
                p.y += p.vy;
                p.life--;
                if (p.life <= 0) particles.splice(i, 1);
            }
            
            // Update ecosystem health
            if (healthIncrease > 0) {
                ecosystemHealth += Math.min(healthIncrease, 0.1);
                healthIncrease -= 0.1;
                if (ecosystemHealth > 100) ecosystemHealth = 100;
            }
            
            // Pollution slowly spreads if health is low
            if (ecosystemHealth < 50 && Math.random() < 0.001) {
                const x = Math.random() * WORLD_SIZE;
                const y = Math.random() * WORLD_SIZE;
                pollution.push({ x, y });
            }
            
            // Update UI
            document.getElementById('trees').textContent = player.treesPlanted;
            document.getElementById('cleaned').textContent = player.pollutionCleaned;
            document.getElementById('solar').textContent = player.solarDeployed;
            document.getElementById('impact').textContent = player.impact;
            
            document.getElementById('healthFill').style.width = ecosystemHealth + '%';
            document.getElementById('healthText').textContent = Math.round(ecosystemHealth) + '%';
            
            updateLeaderboard();
        }
        
        // Update leaderboard
        function updateLeaderboard() {
            const allGuardians = [player, ...bots].sort((a, b) => b.impact - a.impact).slice(0, 6);
            const content = document.getElementById('leaderboardContent');
            content.innerHTML = '';
            
            allGuardians.forEach((guardian, index) => {
                const entry = document.createElement('div');
                entry.className = 'leaderboard-entry' + (guardian.isPlayer ? ' player' : '');
                const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : (index + 1) + '.';
                entry.innerHTML = `<span class="rank">${medal}</span> <span>${guardian.name}</span> <span>${guardian.impact}</span>`;
                content.appendChild(entry);
            });
        }
        
        // Draw game
        function draw() {
            // Clear
            ctx.fillStyle = '#87ceeb';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw tiles
            const startX = Math.floor(camera.x / TILE_SIZE);
            const startY = Math.floor(camera.y / TILE_SIZE);
            const endX = Math.ceil((camera.x + canvas.width) / TILE_SIZE);
            const endY = Math.ceil((camera.y + canvas.height) / TILE_SIZE);
            
            for (let y = startY; y <= endY; y++) {
                for (let x = startX; x <= endX; x++) {
                    const tile = getTile(x, y);
                    if (tile) {
                        ctx.fillStyle = TILE_COLORS[tile.type];
                        ctx.fillRect(
                            x * TILE_SIZE - camera.x,
                            y * TILE_SIZE - camera.y,
                            TILE_SIZE,
                            TILE_SIZE
                        );
                        
                        // Grid lines
                        ctx.strokeStyle = 'rgba(0,0,0,0.1)';
                        ctx.lineWidth = 1;
                        ctx.strokeRect(
                            x * TILE_SIZE - camera.x,
                            y * TILE_SIZE - camera.y,
                            TILE_SIZE,
                            TILE_SIZE
                        );
                    }
                }
            }
            
            // Draw pollution
            for (let p of pollution) {
                ctx.beginPath();
                ctx.arc(p.x - camera.x, p.y - camera.y, 8, 0, Math.PI * 2);
                ctx.fillStyle = '#1a1a1a';
                ctx.fill();
                ctx.strokeStyle = '#666';
                ctx.lineWidth = 2;
                ctx.stroke();
            }
            
            // Draw solar panels
            for (let s of solarPanels) {
                ctx.save();
                ctx.translate(s.x - camera.x, s.y - camera.y);
                
                // Panel
                ctx.fillStyle = '#1e40af';
                ctx.fillRect(-12, -8, 24, 16);
                ctx.strokeStyle = '#fbbf24';
                ctx.lineWidth = 2;
                ctx.strokeRect(-12, -8, 24, 16);
                
                // Grid
                ctx.strokeStyle = '#fbbf24';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(-12, 0);
                ctx.lineTo(12, 0);
                ctx.moveTo(0, -8);
                ctx.lineTo(0, 8);
                ctx.stroke();
                
                ctx.restore();
            }
            
            // Draw trees
            for (let tree of trees) {
                const scale = tree.age / 100;
                ctx.save();
                ctx.translate(tree.x - camera.x, tree.y - camera.y);
                
                // Trunk
                ctx.fillStyle = '#6d4c41';
                ctx.fillRect(-3 * scale, 0, 6 * scale, 15 * scale);
                
                // Leaves
                ctx.beginPath();
                ctx.arc(0, -5 * scale, 12 * scale, 0, Math.PI * 2);
                ctx.fillStyle = scale < 0.5 ? '#7cb342' : '#2e7d32';
                ctx.fill();
                
                ctx.restore();
            }
            
            // Draw particles
            for (let p of particles) {
                ctx.globalAlpha = p.life / 30;
                ctx.beginPath();
                ctx.arc(p.x - camera.x, p.y - camera.y, 4, 0, Math.PI * 2);
                ctx.fillStyle = p.color;
                ctx.fill();
                ctx.globalAlpha = 1;
            }
            
            // Draw guardians
            player.draw();
            for (let bot of bots) {
                bot.draw();
            }
        }
        
        // Game loop
        function gameLoop() {
            if (!gameStarted) return;
            
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }
        
        // Event listeners
        window.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            
            // Action shortcuts
            if (e.key === '1' || e.key === 't' || e.key === 'T') {
                setAction('tree');
                player.performAction('tree');
            } else if (e.key === '2' || e.key === 'c' || e.key === 'C') {
                setAction('cleanup');
                player.performAction('cleanup');
            } else if (e.key === '3' || e.key === 's' || e.key === 'S') {
                setAction('solar');
                player.performAction('solar');
            } else if (e.key === ' ') {
                e.preventDefault();
                player.performAction(currentAction);
            }
        });
        
        window.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });
        
        document.getElementById('startButton').addEventListener('click', init);
        document.getElementById('nameInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') init();
        });
        
        setAction('tree');
        document.getElementById('nameInput').focus();
    </script>
</body>
</html>
